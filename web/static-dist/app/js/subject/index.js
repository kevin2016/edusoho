!function(t){function e(e){for(var n,r,o=e[0],u=e[1],c=e[2],d=0,h=[];d<o.length;d++)r=o[d],Object.prototype.hasOwnProperty.call(s,r)&&s[r]&&h.push(s[r][0]),s[r]=0;for(n in u)Object.prototype.hasOwnProperty.call(u,n)&&(t[n]=u[n]);for(l&&l(e);h.length;)h.shift()();return a.push.apply(a,c||[]),i()}function i(){for(var t,e=0;e<a.length;e++){for(var i=a[e],n=!0,o=1;o<i.length;o++){var u=i[o];0!==s[u]&&(n=!1)}n&&(a.splice(e--,1),t=r(r.s=i[0]))}return t}var n={},s={370:0},a=[];function r(e){if(n[e])return n[e].exports;var i=n[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=t,r.c=n,r.d=function(t,e,i){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)r.d(i,n,function(e){return t[e]}.bind(null,n));return i},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="/static-dist/";var o=window.webpackJsonp=window.webpackJsonp||[],u=o.push.bind(o);o.push=e,o=o.slice();for(var c=0;c<o.length;c++)e(o[c]);var l=u;a.push([1365,0]),i()}({1140:function(t,e,i){t.exports=i(1141)},1141:function(t,e,i){i(1142),t.exports=i(53).Reflect.get},1142:function(t,e,i){var n=i(217),s=i(502),a=i(326),r=i(72),o=i(196),u=i(135);r(r.S,"Reflect",{get:function t(e,i){var r,c,l=arguments.length<3?e:arguments[2];return u(e)===l?e[i]:(r=n.f(e,i))?a(r,"value")?r.value:void 0!==r.get?r.get.call(l):void 0:o(c=s(e))?t(c,i,l):void 0}})},1143:function(t,e,i){var n=i(9);t.exports=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=n(t)););return t}},1365:function(t,e,i){"use strict";i.r(e),i.d(e,"default",(function(){return st}));var n=i(183),s=i.n(n),a=i(83),r=i.n(a),o=i(208),u=i.n(o),c=i(189),l=i.n(c),d=i(141),h=i.n(d),f=i(26),m=i.n(f),p=i(19),v=i.n(p),g=i(42),y=i.n(g),b=i(10),k=i.n(b),j=i(2),T=i.n(j),_=i(3),q=i.n(_),x=i(21),w=function(){function t(){T()(this,t),this.questions={},this.eventManager={},this.tokenList=[],this.$itemList=$(".js-item-list"),this.questionCounts={},this.totalScore=0,this.flag=!0,this.init()}return q()(t,[{key:"init",value:function(){this.initQuestions(),this.initQuestionCountsAndTotalScore(),this.flag=!1}},{key:"initQuestions",value:function(){for(var t=this,e=this._toJson($(".js-cached-data").text()),i=function(i){var n=t._getToken(),s=e[i];s.categoryId=0,t.questions[n]=s,t.tokenList.push(n);var a=i;$('[data-anchor="#'.concat(a,'"]')).attr("data-anchor","#".concat(n));var r=$("#".concat(a)).attr("id",n);"material"===s.type&&$.each(s.subQuestions,(function(t,e){r=r.next('[data-key="'.concat(t,'"]')).attr("data-material-token",n)}))},n=0;n<e.length;n++)i(n)}},{key:"initQuestionCountsAndTotalScore",value:function(){this.questionCounts={total:0,single_choice:0,choice:0,uncertain_choice:0,determine:0,fill:0,essay:0,material:0};var t=this;y()(this.questions).forEach((function(e){var i=t.questions[e];t.questionCounts.total++,t.questionCounts[i.type]++,"material"!==i.type?t.totalScore=(v()(t.totalScore)+v()(i.score)).toFixed(1):$.each(i.subQuestions,(function(e,i){t.totalScore=(v()(t.totalScore)+v()(i.score)).toFixed(1)}))}))}},{key:"getQuestionCount",value:function(t){return this.questionCounts[t]}},{key:"getTotalScore",value:function(){return this.totalScore}},{key:"getQuestionOrder",value:function(t){return this.tokenList.indexOf(t)+1}},{key:"getTokenList",value:function(){return this.tokenList}},{key:"modifyDifficulty",value:function(t,e,i){var n=this;$.each(t,(function(t,s){void 0!==n.questions[s]&&(n.updateQuestionItem(s,"difficulty",e),n.$itemList.find("#".concat(s)).find(".js-difficulty").html(i))}))}},{key:"modifyScore",value:function(t,e,i){var n=this;$.each(t,(function(t,s){n.$itemList.find("#".concat(s)).find(".js-score").html("".concat(e.score).concat(Translator.trans("subject.question_score_unit")));var a=n.getQuestion(s);n.updateQuestionItem(s,"score",e.score,!1),i&&("choice"!==a.type&&"uncertain_choice"!==a.type||n.updateQuestionItem(s,"missScore",e.missScore))})),n.trigger("updateQuestionScore")}},{key:"modifyCategory",value:function(t,e,i){var n=this;$.each(t,(function(t,s){void 0!==n.questions[s]&&(n.updateQuestionItem(s,"categoryId",e),n.$itemList.find("#".concat(s)).find(".js-category").html(Object(x.h)(i,8)),n.$itemList.find("#".concat(s)).find(".js-category").attr("data-original-title",i))}))}},{key:"addQuestion",value:function(t,e){if(this.isUpdating()){this.flag=!0,"material"===e.type&&(e.subQuestions=[],e.score=0);var i=this._getToken();this.questions[i]=e;var n=this.tokenList.indexOf(t)+1;this.tokenList.splice(n,0,i),this.questionCounts.total++,this.questionCounts[e.type]++,this.totalScore=(v()(this.totalScore)+v()(e.score)).toFixed(1);var s=n+1;return this.trigger("addQuestion",[s,i,e.type]),this.flag=!1,i}}},{key:"deleteQuestion",value:function(t){if(this.isUpdating()){this.flag=!0;var e=this.questions[t];delete this.questions[t];var i=this.tokenList.indexOf(t);if(this.tokenList.splice(i,1),this.questionCounts.total--,this.questionCounts[e.type]--,"material"!==e.type)this.totalScore=(v()(this.totalScore)-v()(e.score)).toFixed(1);else{var n=this;$.each(e.subQuestions,(function(t,e){n.totalScore=(v()(n.totalScore)-v()(e.score)).toFixed(1)}))}this.trigger("deleteQuestion",[e.type]),this.flag=!1}}},{key:"updateQuestionItem",value:function(t,e,i){var n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(this.isUpdating()){this.flag=!0;var s=this.questions[t][e];this.questions[t][e]=i,"score"===e&&(this.totalScore=(this.totalScore-v()(s)+v()(i)).toFixed(1),this.trigger("updateQuestionScore",[n])),"type"===e&&s!=i&&(this.questionCounts[s]--,this.questionCounts[i]++,this.trigger("updateQuestionType",[e,i,s,t])),this.flag=!1}}},{key:"getQuestion",value:function(t){if(this.isUpdating())return this.questions[t]}},{key:"getQuestions",value:function(){return this.questions}},{key:"getSubQuestion",value:function(t,e){if(this.isUpdating())return this.questions[t].subQuestions[e]}},{key:"addSubQuestion",value:function(t,e){if(this.isUpdating())return this.flag=!0,this.questions[t].subQuestions.push(e),this.totalScore=(v()(this.totalScore)+v()(e.score)).toFixed(1),this.trigger("updateQuestionScore"),this.flag=!1,t}},{key:"updateSubQuestionItem",value:function(t,e,i,n){var s=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(this.isUpdating()){this.flag=!0;var a=this.questions[t].subQuestions[e][i];this.questions[t].subQuestions[e][i]=n,"score"==i&&(this.totalScore=(this.totalScore-v()(a)+v()(n)).toFixed(1),this.trigger("updateQuestionScore",[s])),this.flag=!1}}},{key:"deleteSubQuestion",value:function(t,e){if(this.isUpdating()){this.flag=!0;var i=this.questions[t].subQuestions[e];this.questions[t].subQuestions.splice(e,1),this.totalScore=(v()(this.totalScore)-v()(i.score)).toFixed(1),this.correctMaterialQuestion(t),this.trigger("updateQuestionScore"),this.flag=!1}}},{key:"correctQuestion",value:function(t){var e=this.questions[t];void 0!==e.errors&&("material"===e.type&&void 0!==e.errors.hasSubError?e.errors={hasSubError:!0}:delete e.errors,this.questions[t]=e,void 0===e.errors&&this.trigger("correctQuestion",[t]))}},{key:"correctSubQuestion",value:function(t,e){var i=this.questions[t],n=i.subQuestions[e];void 0!==n.errors&&(delete n.errors,i.subQuestions[e]=n,this.questions[t]=i,this.correctMaterialQuestion(t))}},{key:"correctMaterialQuestion",value:function(t){var e=this.questions[t],i=!1;$.each(e.subQuestions,(function(t,e){void 0!==e.errors&&(i=!0)})),i||void 0===e.errors||delete e.errors.hasSubError,$.isEmptyObject(e.errors)&&(delete e.errors,this.trigger("correctQuestion",[t])),this.questions[t]=e}},{key:"isUpdating",value:function(){return!0!==this.flag||(cd.message({type:"danger",message:Translator.trans("course.question.is_updating_hint")}),!1)}},{key:"_toJson",value:function(t){var e={};return t&&(e=$.parseJSON(t.replace(/[\r\n\t]/g,""))),e}},{key:"on",value:function(t,e){this.eventManager[t]?this.eventManager[t].push(e.bind(this)):this.eventManager[t]=[e.bind(this)]}},{key:"trigger",value:function(t,e){this.eventManager[t]&&this.eventManager[t].map((function(t){t.apply(null,e)}))}},{key:"_random",value:function(){return(65536*(1+Math.random())|0).toString(16).substring(1)}},{key:"_getToken",value:function(){return this._random()+this._random()+"-"+this._random()+"-"+this._random()+"-"+this._random()+"-"+this._random()+this._random()+this._random()}}]),t}(),S=i(134),Q=function(){function t(e,i){T()(this,t),this.$form=e,this.operate=i,this.titleFieldId="question-stem-field",this.$analysisModal=$(".js-analysis-modal"),this.validator=null,this.titleEditorToolBarName="Minimal",this.analysisEditor=null,this._init(),this.attachmentActions=new S.a(e)}return q()(t,[{key:"_init",value:function(){this._initEvent(),this._initValidate(),this._initAnalysisEditor(),this._initSelect()}},{key:"_initEvent",value:function(){var t=this;this.$form.on("click",".js-finish-edit",(function(e){return t.submitForm(e)})),this.$form.on("click",".js-analysis-edit",(function(e){return t.showAnalysisModal(e)})),this.$analysisModal.on("click",".js-analysis-btn",(function(e){return t.saveAnalysis(e)})),$('[data-toggle="tooltip"]').tooltip()}},{key:"_initSelect",value:function(){$("[name=categoryId]").select2({treeview:!0,dropdownAutoWidth:!0,treeviewInitState:"collapsed",placeholderOption:"first"})}},{key:"_initTooltip",value:function(){$("[data-toggle=tooltip]").tooltip()}},{key:"submitForm",value:function(t){var e=this;if(e.validator.form()){$(t.currentTarget).button("loading");var i=e.getQuestion();e.finishEdit(i),e.changeBottomFixed()}}},{key:"changeBottomFixed",value:function(){var t=k()(window.scrollY+document.documentElement.clientHeight),e=0;if($(".es-footer-link").length?e=k()($(".es-footer-link").offset().top):$(".es-footer").length&&(e=k()($(".es-footer").offset().top)),e)e<t&&$(".js-subject-item-btn").removeClass("subject-bottom-fixed");else{var i=k()($(document).scrollTop()),n=k()($(document.body).height());i+k()($(window).height())>=n-560&&$(".js-subject-item-btn").removeClass("subject-bottom-fixed")}}},{key:"_initAnalysisEditor",value:function(){var t=this,e=this.$form.find('[data-edit="analysis"]').val(),i=$(".js-analysis-field");CKEDITOR.instances[i.attr("id")]&&CKEDITOR.instances[i.attr("id")].destroy(),i.val(e),this.analysisEditor=CKEDITOR.replace(i.attr("id"),{toolbar:this.titleEditorToolBarName,fileSingleSizeLimit:app.fileSingleSizeLimit,filebrowserImageUploadUrl:i.data("imageUploadUrl"),height:i.height()}),this.analysisEditor.on("change",(function(){i.val(t.analysisEditor.getData())})),this.analysisEditor.on("blur",(function(){i.val(t.analysisEditor.getData())}))}},{key:"showAnalysisModal",value:function(t){var e=$(t.currentTarget).prev('[data-edit="analysis"]').val();this.analysisEditor.setData(e),this.$analysisModal.modal("show")}},{key:"saveAnalysis",value:function(t){var e=this.analysisEditor.getData();$('[data-edit="analysis"]').val(e),$(".js-analysis-content").html($(this.replacePicture(e)).text()),this.$analysisModal.modal("hide")}},{key:"finishEdit",value:function(t){var e=this,i=$(".js-hidden-token").val(),n=$(".js-hidden-method").val(),s=$(".js-sub-judge").val(),a=$(".js-edit-form-seq").text()-1,r=0;"1"==s?(i=e.updateCachedSubQuestion(i,a,t,n),t=e.operate.getSubQuestion(i,a),r=a+1):(i=e.updateCachedQuestion(i,t,n),t=e.operate.getQuestion(i),r=e.operate.getQuestionOrder(i)),this.analysisEditor.destroy(),$.post(e.$form.data("url"),{seq:r,question:t,token:i,isSub:s},(function(t){e.$form.parent(".subject-item").replaceWith(t),e._initTooltip()}))}},{key:"updateCachedQuestion",value:function(t,e,i){var n=this;return"add"==i?t=n.operate.addQuestion(t,e):($.each(e,(function(e,i){n.operate.updateQuestionItem(t,e,i)})),n.operate.correctQuestion(t)),t}},{key:"updateCachedSubQuestion",value:function(t,e,i,n){var s=this;return"add"==n?t=s.operate.addSubQuestion(t,i):($.each(i,(function(i,n){s.operate.updateSubQuestionItem(t,e,i,n)})),s.operate.correctSubQuestion(t,e)),t}},{key:"getQuestion",value:function(){var t={};return $("*[data-edit]").each((function(){var e=$(this).data("edit"),i=$(this).val();t[e]=i})),t.difficulty=$("input[name='difficulty']:checked").val(),t.attachment=this.getAttachments(),t=this.filterQuestion(t)}},{key:"filterQuestion",value:function(t){return t}},{key:"getAttachments",value:function(){var t={};return $(".js-attachment-list-stem").find(".js-attachment-name").length>0&&(t.stem={type:"attachment",targetType:"question.stem",fileIds:$(".js-attachment-ids-stem").val(),fileName:$(".js-attachment-list-stem").find(".js-attachment-name").text()}),$(".js-attachment-list-analysis").find(".js-attachment-name").length>0&&(t.analysis={type:"attachment",targetType:"question.analysis",fileIds:$(".js-attachment-ids-analysis").val(),fileName:$(".js-attachment-list-analysis").find(".js-attachment-name").text()}),t}},{key:"_initValidate",value:function(){var t=this.$form.validate({onkeyup:!1,rules:{difficulty:{required:!0},stem:{required:!0},score:{required:!0,number:!0,max:999,min:0,es_score:!0}},messages:{difficulty:Translator.trans("course.question.create.difficulty_required_error_hint"),stem:{required:Translator.trans("subject.stem_required")}}});this.validator=t}},{key:"initTitleEditor",value:function(t){var e=this,i=$("#"+e.titleFieldId),n=i.prev(),s=CKEDITOR.replace(e.titleFieldId,{toolbar:e.titleEditorToolBarName,fileSingleSizeLimit:app.fileSingleSizeLimit,filebrowserImageUploadUrl:i.data("imageUploadUrl"),height:i.height()});s.on("change",(function(){i.val(s.getData()),n.val($(e.replacePicture(s.getData())).text())})),s.on("blur",(function(){i.val(s.getData()),n.val($(e.replacePicture(s.getData())).text())})),s.on("instanceReady",(function(){this.focus(),$('[data-role="edit"]').one("click",(function(){n.val($(e.replacePicture(s.getData())).text()),i.val(s.getData()),s.destroy(),i.hide(),n.show()}))}))}},{key:"replacePicture",value:function(t){return t.replace(/<img [^>]*src=['"]([^'"]+)[^>]*>/gi,"[".concat(Translator.trans("subject.symbol.picture"),"]"))}},{key:"titleEditorToolBarName",set:function(t){this._titleEditorToolBarName=t},get:function(){return this._titleEditorToolBarName}}]),t}(),C=i(6),O=i.n(C),I=i(12),E=i.n(I),M=i(13),D=i.n(M),F=i(9),L=i.n(F);function B(t){var e=function(){if("undefined"==typeof Reflect||!O.a)return!1;if(O.a.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(O()(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=L()(t);if(e){var s=L()(this).constructor;i=O()(n,arguments,s)}else i=n.apply(this,arguments);return D()(this,i)}}var A=function(t){E()(i,t);var e=B(i);function i(t,n){var s;return T()(this,i),(s=e.call(this,t,n)).validator=null,s.oldFieldId="question-stem-field",s.fieldId="",s.optionCount=0,s.timer=!1,s.errorMessage={noAnswer:Translator.trans("subject.choice_answer_least_two")},s.init(),s}return q()(i,[{key:"init",value:function(){this.initTitleEditor(this.validator),this.initOptionCount(),this.initData(),this.initEvent(),this.initValidator()}},{key:"initOptionCount",value:function(){this.optionCount=$(".edit-subject-item").length}},{key:"initEvent",value:function(){var t=this;this.$form.on("focus",".js-item-option-edit",(function(e){return t.editOption(e)})),this.$form.on("click",".js-item-option-delete",(function(e){return t.deleteOption(e)})),this.$form.on("click",".js-item-option-add",(function(e){return t.addOption(e)})),this.$form.on("click",'[data-role="edit"]',(function(e){return t.editOption(e)}))}},{key:"initData",value:function(){$(".cd-checkbox.checked").find('[name="right"]').attr("checked",!0)}},{key:"initValidator",value:function(){$.validator&&($.validator.prototype.elements=function(){var t=this,e={};return $(this.currentForm).find("input, textarea").not(":submit, :reset, :image, [disabled]").not(this.settings.ignore).filter((function(){return!this.name&&t.settings.debug&&window.console&&console.error("%o has no name assigned",this),e[this.name]=!0,!0}))},$.validator.addMethod("noMoreThan",(function(t,e,i){return""==t||v()(t)<=v()($(i).val())}),"Please enter a lesser value."),$.validator.addMethod("multi",(function(t,e,i){return $('input:checkbox[name="right"]:checked').length>1})));var t=this;this.$form.validate().destroy(),this.validator=this.$form.validate({onkeyup:!1,rules:{score:{required:!0,max:999,min:0,es_score:!0},missScore:{required:!1,max:999,min:0,noMoreThan:'[name="score"]',es_score:!0},stem:{required:!0},options:{required:!0},right:{required:!0,multi:!0}},messages:{missScore:{noMoreThan:Translator.trans("subject.miss_score_no_more_than_score")},stem:{required:Translator.trans("subject.validate.stem_required")},options:{required:Translator.trans("subject.validate.option_required")}},errorPlacement:function(e,i){var n=i.attr("name");"right"==n?($(".edit-subject-item__order").addClass("edit-subject-item__order--error"),cd.message({type:"danger",message:t.errorMessage.noAnswer})):"stem"==n?$("#cke_question-stem-field").after(e):"options"==n&&i.prev().hasClass("hidden")?e.appendTo(i.parent()):e.insertAfter(i)}})}},{key:"editOption",value:function(t){var e=this,i=$(t.currentTarget),n=i.next();this.fieldId=n.attr("id"),i.addClass("hidden");var s=$("#"+this.fieldId),a=null;if(CKEDITOR.instances[this.oldFieldId]){a=CKEDITOR.instances[this.oldFieldId];var r=$("#"+this.oldFieldId);r.addClass("hidden"),r.prevAll("input").first().removeClass("hidden").show().val($(e.replacePicture(a.getData())).text()),CKEDITOR.instances[this.oldFieldId].destroy()}this.oldFieldId=this.fieldId,CKEDITOR.instances[this.fieldId]&&CKEDITOR.instances[this.fieldId].destroy(),(a=CKEDITOR.replace(this.fieldId,{toolbar:"Minimal",fileSingleSizeLimit:app.fileSingleSizeLimit,filebrowserImageUploadUrl:s.data("imageUploadUrl"),height:s.height(),startupFocus:!0})).focus(),a.on("change",(function(){s.val(a.getData()),s.prev("input").val($(e.replacePicture(a.getData())).text())})),a.on("blur",(function(){s.val(a.getData()),s.prev("input").val($(e.replacePicture(a.getData())).text())}))}},{key:"deleteOption",value:function(t){if(this.optionCount<=2)cd.message({type:"danger",message:Translator.trans("subject.choice_option_least_two")});else{var e=$(t.currentTarget).parents(".edit-subject-item"),i=e.find(".edit-subject-item__order").text(),n=e.find('input[name="right"]').val();e.nextAll(".edit-subject-item").each((function(){var t=$(this).find(".edit-subject-item__order"),e=t.text();t.text(i),i=e,$(this).find('input[name="right"]').val(n),n++})),e.remove(),this.optionCount--}}},{key:"addOption",value:function(t){var e=this;e.timer&&clearTimeout(e.timer),e.timer=setTimeout((function(){e.addRealOperate(t)}),500)}},{key:"addRealOperate",value:function(t){var e=this,i=$(t.currentTarget);if(this.optionCount>=10)return cd.message({type:"danger",message:Translator.trans("subject.choice_option_most_ten")}),void i.attr("disabled",!1);var n=$('[name="type"]').val();$.ajax({url:"/subject/option/".concat(n),type:"get",data:{order:this.optionCount}}).done((function(i){$(t.currentTarget).parent().before(i),e.optionCount++}))}},{key:"submitForm",value:function(t){this.optionCount<2?cd.message({type:"danger",message:Translator.trans("subject.choice_option_least_two")}):(this.validator.resetForm(),this.validator.form()&&($(t.currentTarget).button("loading"),this.finishEdit(this.$form.serializeArray())))}},{key:"finishEdit",value:function(t){var e=$(".js-hidden-token").val(),i=this,n={options:[],answers:[]};$.each(t,(function(t,e){var i=e.name,s=e.value;-1!==$.inArray(i,["stem","difficulty","score","missScore","type","analysis","categoryId"])?n[i]=s:"options"==i?n.options.push(s):"right"==i&&n.answers.push(s)})),n.attachment=this.getAttachments();var s=$(".js-hidden-method").val(),a=$(".js-sub-judge").val(),r=$(".js-edit-form-seq").text()-1,o=0;"1"==a?(e=i.updateCachedSubQuestion(e,r,n,s),n=i.operate.getSubQuestion(e,r),o=r+1):(e=i.updateCachedQuestion(e,n,s),n=i.operate.getQuestion(e),o=i.operate.getQuestionOrder(e)),this.analysisEditor.destroy(),$.post(i.$form.data("url"),{seq:o,question:n,token:e,isSub:a},(function(t){i.$form.parent(".subject-item").replaceWith(t),i._initTooltip()}))}}]),i}(Q),R=i(398),P=i.n(R);function U(t){var e=function(){if("undefined"==typeof Reflect||!O.a)return!1;if(O.a.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(O()(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=L()(t);if(e){var s=L()(this).constructor;i=O()(n,arguments,s)}else i=n.apply(this,arguments);return D()(this,i)}}var N=function(t){E()(i,t);var e=U(i);function i(t,n){var s;return T()(this,i),(s=e.call(this,t,n)).errorMessage={noAnswer:Translator.trans("subject.choice_require_answer")},s}return q()(i,[{key:"initEvent",value:function(){var t=this;P()(L()(i.prototype),"initEvent",this).call(this),this.$form.on("change",'input:radio[name="right"]',(function(e){return t.changeRadio(e)}))}},{key:"initData",value:function(){P()(L()(i.prototype),"initData",this).call(this);var t=this.$form.find(".js-choose-item");$(".cd-radio.checked").find('[name="right"]').attr("checked",!0),this.checkedRadio=t.find(".cd-radio.checked")}},{key:"initValidator",value:function(){P()(L()(i.prototype),"initValidator",this).call(this),$.validator.addMethod("multi",(function(t,e,i){return!0}))}},{key:"changeRadio",value:function(t){this.checkedRadio&&this.checkedRadio.removeClass("checked"),this.checkedRadio=$(t.currentTarget).parent()}}]),i}(A);function V(t){var e=function(){if("undefined"==typeof Reflect||!O.a)return!1;if(O.a.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(O()(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=L()(t);if(e){var s=L()(this).constructor;i=O()(n,arguments,s)}else i=n.apply(this,arguments);return D()(this,i)}}var z=function(t){E()(i,t);var e=V(i);function i(t,n){var s;return T()(this,i),(s=e.call(this,t,n)).errorMessage={noAnswer:Translator.trans("subject.choice_require_answer")},s}return q()(i,[{key:"initValidator",value:function(){P()(L()(i.prototype),"initValidator",this).call(this),$.validator.addMethod("multi",(function(t,e,i){return!0}))}}]),i}(A);function K(t){var e=function(){if("undefined"==typeof Reflect||!O.a)return!1;if(O.a.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(O()(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=L()(t);if(e){var s=L()(this).constructor;i=O()(n,arguments,s)}else i=n.apply(this,arguments);return D()(this,i)}}var J=function(t){E()(i,t);var e=K(i);function i(t,n){var s;return T()(this,i),(s=e.call(this,t,n)).initTitleEditor(s.validator),s.$answerField=$('[name="answer"]'),s.init(),s}return q()(i,[{key:"init",value:function(){this.$answerField.rules("add",{required:!0,messages:{required:Translator.trans("course.question.create.right_answer_required_error_hint")}})}},{key:"filterQuestion",value:function(t){var e=$("input[name='answer']:checked").val();return t.answer="true"==e,t}}]),i}(Q);function W(t){var e=function(){if("undefined"==typeof Reflect||!O.a)return!1;if(O.a.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(O()(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=L()(t);if(e){var s=L()(this).constructor;i=O()(n,arguments,s)}else i=n.apply(this,arguments);return D()(this,i)}}jQuery.validator.addMethod("fillCheck",(function(t,e){return this.optional(e)||/(\[\[(.+?)\]\])/i.test(t)}),Translator.trans("course.question.create.fill_hint"));var H=function(t){E()(i,t);var e=W(i);function i(t,n){var s;return T()(this,i),(s=e.call(this,t,n)).titleEditorToolBarName="Question",s.initTitleEditor(s.validator),s.$titleField=$("#"+s.titleFieldId),s.init(),s}return q()(i,[{key:"init",value:function(){this.$titleField.rules("add",{fillCheck:!0})}},{key:"filterQuestion",value:function(t){var e=t.stem.match(/\[\[(.+?)\]\]/g);if(null!=e){t.answers=[];for(var i=0;i<e.length;i++){var n=e[i].substring(2);n=n.substring(0,n.length-2),t.answers.push(n)}}return t}}]),i}(Q);function Y(t){var e=function(){if("undefined"==typeof Reflect||!O.a)return!1;if(O.a.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(O()(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=L()(t);if(e){var s=L()(this).constructor;i=O()(n,arguments,s)}else i=n.apply(this,arguments);return D()(this,i)}}var G=function(t){E()(i,t);var e=Y(i);function i(t,n){var s;return T()(this,i),(s=e.call(this,t,n)).initTitleEditor(s.validator),s.answerFieldId="question-answer-field",s.$answerField=$("#"+s.answerFieldId),s.init(),s}return q()(i,[{key:"init",value:function(){var t=this;this.$answerField.rules("add",{required:!0,messages:{required:Translator.trans("subject.essay_require_answer")}}),this.$form.on("click",'[data-role="edit"]',(function(e){return t.answerClick(e)}))}},{key:"answerClick",value:function(t){var e=this,i=$(t.currentTarget),n=i.next();i.hide();var s=CKEDITOR.replace(n.attr("id"),{toolbar:"Minimal",fileSingleSizeLimit:app.fileSingleSizeLimit,filebrowserImageUploadUrl:n.data("imageUploadUrl"),height:n.height()});s.on("change",(function(){n.val(s.getData()),i.val($(e.replacePicture(s.getData())).text())})),s.on("blur",(function(){n.val(s.getData()),i.val($(e.replacePicture(s.getData())).text())})),s.on("instanceReady",(function(){this.focus(),$('[data-role="edit"]').one("click",(function(){i.val($(e.replacePicture(s.getData())).text()),n.val(s.getData()),s.destroy(),n.hide(),i.show()}))}))}}]),i}(Q);function X(t){var e=function(){if("undefined"==typeof Reflect||!O.a)return!1;if(O.a.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(O()(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=L()(t);if(e){var s=L()(this).constructor;i=O()(n,arguments,s)}else i=n.apply(this,arguments);return D()(this,i)}}var Z=function(t){E()(i,t);var e=X(i);function i(t,n){var s;return T()(this,i),(s=e.call(this,t,n)).initTitleEditor(s.validator),s}return i}(Q),tt=function(){function t(){T()(this,t)}return q()(t,null,[{key:"getEditor",value:function(t,e,i){switch(t){case"single_choice":new N(e,i);break;case"uncertain_choice":new z(e,i);break;case"choice":new A(e,i);break;case"determine":new J(e,i);break;case"essay":new G(e,i);break;case"fill":new H(e,i);break;case"material":new Z(e,i);break;default:new Q(e,i).initTitleEditor()}}}]),t}(),et=i(138);function it(t,e){var i;if(void 0===l.a||null==t[u.a]){if(r()(t)||(i=function(t,e){if(!t)return;if("string"==typeof t)return nt(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return h()(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return nt(t,e)}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0,a=function(){};return{s:a,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,c=!0,d=!1;return{s:function(){i=s()(t)},n:function(){var t=i.next();return c=t.done,t},e:function(t){d=!0,o=t},f:function(){try{c||null==i.return||i.return()}finally{if(d)throw o}}}}function nt(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}var st=function(){function t(){T()(this,t),this.$element=$(".js-subject-list"),this.$itemList=$(".js-item-list"),this.$subjectData=$(".js-subject-data"),this.$batchBtn=$(".js-batch-btn"),this.$allBtn=$(".js-batch-select"),this.flag=!0,this.$diffiultyModal=$(".js-difficulty-modal"),this.$scoreModal=$(".js-score-modal"),this.$categoryModal=$(".js-category-modal"),this.scoreValidator=null,this.selectQuestion=[],this.questionOperate=null,this.testpaperTitle="",this.redirect=!1,this.questionOperate=null,this.timer=!1,this.questionBankId=$("#questionBankId").val(),this.init()}return q()(t,[{key:"init",value:function(){this.initQuestionOperate(),this.confirmFresh(),this.sbListFixed(),this.footerButtonFixed(),this.initEvent(),this.initScoreValidator(),this.setDifficulty(),this.initTestpaperTitle(),this.itemClick(),this.statErrorQuestions(),this.ieImg(),this.initSelect(),this.initTooltip()}},{key:"initQuestionOperate",value:function(){var t=this;t.questionOperate=new w,t.questionOperate.on("correctQuestion",(function(e){$('[data-anchor="#'.concat(e,'"]')).hasClass("subject-list-item__num--error")&&($('[data-anchor="#'.concat(e,'"]')).removeClass("subject-list-item__num--error"),t.statErrorQuestions())})),t.questionOperate.on("addQuestion",(function(e,i,n){$('[data-anchor="#'.concat(e,'"]')).attr("data-anchor","#"+i),t.updateTotalScoreText(),t.updateQuestionCountText(n)})),t.questionOperate.on("deleteQuestion",(function(e){t.updateTotalScoreText(),t.updateQuestionCountText(e)})),t.questionOperate.on("updateQuestionScore",(function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];t.updateTotalScoreText(e)})),t.questionOperate.on("updateQuestionType",(function(e,i,n,s){t.updateQuestionCountText(i),t.updateQuestionCountText(n),t.questionTypeConvert(i,s)}))}},{key:"initSelect",value:function(){$("[name=categoryId]").select2({treeview:!0,dropdownAutoWidth:!0,treeviewInitState:"collapsed",placeholderOption:"first"})}},{key:"initTooltip",value:function(){$("[data-toggle=tooltip]").tooltip()}},{key:"confirmFresh",value:function(){var t=this;$(window).on("beforeunload",(function(){if(!t.redirect)return Translator.trans("admin.block.not_saved_data_hint")}))}},{key:"initEvent",value:function(){var t=this;this.$element.on("click",".js-batch-select",(function(e){return t.batchToItem(e)})),this.$element.on("click",".js-show-checkbox",(function(e){return t.itemToBatch(e)})),this.$element.on("click",".js-batch-btn",(function(e){return t.batchBtnClick(e)})),this.$element.on("click",".js-finish-btn",(function(e){return t.finishBtnClick(e)})),this.$element.on("click","*[data-anchor]",(function(e){return t.quickToQuestion(e,t.flag)})),this.$element.on("click",".js-difficult-setting",(function(e){return t.showModal(e,t.$diffiultyModal)})),this.$element.on("click",".js-category-setting",(function(e){return t.showModal(e,t.$categoryModal)})),this.$element.on("click",".js-score-setting",(function(e){return t.showScoreModal(e)})),this.$scoreModal.on("click",".js-batch-score-confirm",(function(e){return t.batchSetScore(e)})),this.$categoryModal.on("click",".js-batch-set-category",(function(e){return t.batchSetCategory(e)})),this.$itemList.on("click",".js-item-edit",(function(e){return t.itemEdit(e)})),this.$itemList.on("click",".js-item-delete",(function(e){return t.deleteSubjectItem(e)})),this.$itemList.on("change",".js-testpaper-title",(function(e){return t.editTestpaperTitle(e)})),this.$itemList.on("click",".js-import-btn",(function(e){return t.finishImport(e)}))}},{key:"initTestpaperTitle",value:function(){var t=this;this.isTestpaper()&&(this.testpaperTitle=$(".js-testpaper-title").val()),this.$itemList.on("click",".subject-change-btn",(function(e){return t.itemConvert(e)})),this.$itemList.on("click",".js-item-add",(function(e){return t.addModalShow(e,!1)})),this.$itemList.on("click",".js-item-add-sub",(function(e){return t.addModalShow(e,!0)})),this.$subjectData.bind("change","*[data-type]",(function(e,i){return t.updateQuestionCountText(i)})),this.$subjectData.bind("change",".js-total-score",(function(e){return t.updateTotalScoreText()}))}},{key:"sbListFixed",value:function(){var t=$(".js-subject-data").width();if(this.$element.length){var e=this,i=this.$element.offset().top;$(window).scroll((function(n){e.$element.width(t),$(window).scrollTop()>=i?e.$element.addClass("sb-fixed"):e.$element.removeClass("sb-fixed")}))}}},{key:"footerButtonFixed",value:function(){window.addEventListener("scroll",Object(et.a)(this.scrollBottom,100,!0))}},{key:"scrollBottom",value:function(){var t=$(".js-subject-item-btn");$(window).scroll((function(e){var i=k()(window.scrollY+document.documentElement.clientHeight),n=0;if($(".es-footer-link").length?n=k()($(".es-footer-link").offset().top):$(".es-footer").length&&(n=k()($(".es-footer").offset().top)),n)n>i?t.addClass("subject-bottom-fixed"):t.removeClass("subject-bottom-fixed");else{var s=k()($(document).scrollTop()),a=k()($(document.body).height());s+k()($(window).height())<a-560?t.addClass("subject-bottom-fixed"):t.removeClass("subject-bottom-fixed")}}))}},{key:"batchToItem",value:function(t){t.currentTarget===t.target&&($(t.currentTarget).hasClass("checked")?this.$element.find(".js-show-checkbox").removeClass("checked"):this.$element.find(".js-show-checkbox").addClass("checked"))}},{key:"itemToBatch",value:function(t){t.currentTarget===t.target&&this.countNumber()}},{key:"countNumber",value:function(){var t=this.$element.find(".js-show-checkbox").length,e=this;setTimeout((function(){var i=$(".js-subject-list-body").find(".checked").length;t===i?e.$allBtn.addClass("checked"):e.$allBtn.removeClass("checked")}),100)}},{key:"batchBtnClick",value:function(t){this.isEditing()||($(t.target).toggleClass("hidden"),this.toggleClass(!0),this.flag=!1)}},{key:"finishBtnClick",value:function(t){this.$element.find(".js-show-checkbox").removeClass("checked"),this.$allBtn.removeClass("checked"),this.$batchBtn.toggleClass("hidden"),this.toggleClass(!1),this.flag=!0}},{key:"toggleClass",value:function(t){t?(this.$element.find(".js-subject-wrap").removeClass("hidden"),this.$element.find(".js-show-checkbox").removeClass("hidden")):(this.$element.find(".js-subject-wrap").addClass("hidden"),this.$element.find(".js-show-checkbox").addClass("hidden"))}},{key:"quickToQuestion",value:function(t,e){var i=$(t.currentTarget);if(e){var n=$(i.attr("data-anchor")).offset();$(document).scrollTop(n.top)}else i.find(".js-show-checkbox").toggleClass("checked"),this.countNumber()}},{key:"showModal",value:function(t,e){if(!this.isEditing()){var i=this.statChosedQuestion();if(0!==y()(i).length){var n="";$.each(i,(function(t,e){var i=e.count+Translator.trans("subject.question_unit")+e.name+Translator.trans("subject.comma");n+=i})),n=n.substring(0,n.length-1)+Translator.trans("subject.period"),e.find(".js-select").html(n),e.modal("show")}else cd.message({type:"danger",message:Translator.trans("subject.select_question_hint")})}}},{key:"showScoreModal",value:function(t){if(!this.isEditing()){var e=this.statChosedQuestion(),i=$(".js-miss-score-field");this.isTestpaper()&&(e.hasOwnProperty("choice")||e.hasOwnProperty("uncertain_choice"))?i.removeClass("hidden"):i.addClass("hidden"),null!=this.scoreValidator&&this.scoreValidator.resetForm(),this.$scoreModal.find("input").each((function(){$(this).val("")})),this.showModal(t,this.$scoreModal)}}},{key:"statChosedQuestion",value:function(){var t={},e=this;return e.$element.find(".js-show-checkbox.checked").each((function(){var i=$(this).data("type"),n=$(this).parent().next(".js-type-name").text(),s=$(this).parents(".js-subject-anchor").data("anchor");void 0===t[i]?t[i]={name:n,count:1}:t[i].count++,e.selectQuestion.push(s.substr(1))})),t}},{key:"initScoreValidator",value:function(){this.scoreValidator=$("#batch-set-score-form").validate({onkeyup:!1,rules:{score:{required:!0,max:999,min:0,es_score:!0},missScore:{required:!1,max:999,min:0,noMoreThan:"#score",es_score:!0}},messages:{missScore:{noMoreThan:Translator.trans("subject.miss_score_no_more_than_score")}}}),$.validator.addMethod("noMoreThan",(function(t,e,i){return""==t||v()(t)<=v()($(i).val())}),"Please enter a lesser value.")}},{key:"isTestpaper",value:function(){return 1==$('input[name="isTestpaper"]').val()}},{key:"batchSetScore",value:function(){if(this.scoreValidator.form()){var t={score:this.$scoreModal.find('input[name="score"]').val(),missScore:this.$scoreModal.find('input[name="missScore"]').val()};this.questionOperate.modifyScore(this.selectQuestion,t,this.isTestpaper()),this.selectQuestion=[],cd.message({type:"success",message:Translator.trans("subject.score_update_success")}),this.$scoreModal.modal("hide")}}},{key:"batchSetCategory",value:function(){var t=this.$categoryModal.find("#categoryId").val(),e=this.$categoryModal.find("#categoryId").find("option:selected").text();this.questionOperate.modifyCategory(this.selectQuestion,t,$.trim(e)),this.selectQuestion=[],cd.message({type:"success",message:Translator.trans("subject.category_update_success")}),this.$categoryModal.modal("hide")}},{key:"setDifficulty",value:function(){var t=this;$(".js-difficulty-btn").click((function(){var e=$("input[name='difficultyRadios']:checked").val(),i=$("input[name='difficultyRadios']:checked").next().text();t.questionOperate.modifyDifficulty(t.selectQuestion,e,i),t.selectQuestion=[],cd.message({type:"success",message:Translator.trans("subject.difficulty_update_success")}),t.$diffiultyModal.modal("hide")}))}},{key:"itemEdit",value:function(t){if(!this.isEditing()){var e=this,i=0,n="",s={},a=0,r=$(t.currentTarget),o=r.parents(".subject-item"),u=r.parents(".subject-item__operation").data("url");void 0!==o.attr("data-material-token")?(i=o.data("key"),n=o.attr("data-material-token"),s=this.questionOperate.getSubQuestion(n,i),a=1,i++):(i=this.questionOperate.getQuestionOrder(o.attr("id")),s=this.questionOperate.getQuestion(o.attr("id")),n=o.attr("id"));var c={seq:i,token:n,question:s,isSub:a,method:"edit",isTestpaper:this.isTestpaper()?1:0,questionBankId:this.questionBankId};$.post(u,c,(function(t){o.replaceWith(t),tt.getEditor(s.type,$(".js-edit-form"),e.questionOperate),e.initSelect()}))}}},{key:"itemConvert",value:function(e){var i=$(e.currentTarget),n=i.parents(".subject-item"),s=i.data("type"),a=i.parents(".subject-change-list").data("fromType"),r=i.parents(".js-edit-form"),o=i.parents(".subject-change-list").data("convertUrl"),u=t._serializeArrayConvertToJson(r.serializeArray());if($(".js-attachment-list").length>0){var c={};$(".js-attachment-list-stem").find(".js-attachment-name").length>0&&(c.stem={type:"attachment",targetType:"question.stem",fileIds:$(".js-attachment-ids-stem").val(),fileName:$(".js-attachment-list-stem").find(".js-attachment-name").text()}),$(".js-attachment-list-analysis").find(".js-attachment-name").length>0&&(c.analysis={type:"attachment",targetType:"question.analysis",fileIds:$(".js-attachment-ids-analysis").val(),fileName:$(".js-attachment-list-analysis").find(".js-attachment-name").text()}),u.attachment=c}var l=$(".js-edit-form-seq").text(),d=$(".js-sub-judge").val(),h=$(".js-hidden-method").val(),f={seq:l,token:u.token,question:u,fromType:a,toType:s,isSub:d,method:h,isTestpaper:this.isTestpaper()?1:0,questionBankId:this.questionBankId};f.fromType=a,f.toType=s;var m=this;$.post(o,f,(function(t){n.replaceWith(t),tt.getEditor(s,$(".js-edit-form"),m.questionOperate)}))}},{key:"itemClick",value:function(){var t=this;$(".js-create-btn").on("click",(function(e){var i=$(e.target);t.timer&&clearTimeout(t.timer),t.timer=setTimeout((function(){i.attr("disabled",!0);var e=$("#cd-modal"),n=e.attr("data-sub"),s=i.data("url"),a=e.attr("data-index"),r=i.data("type");"false"==n?t.itemAdd(a,r,s,i):t.subItemAdd(a,r,s)}),500)}))}},{key:"itemAdd",value:function(t,e,i,n){var s=this,a=s.questionOperate.getQuestionOrder(t)+1,r=this.isTestpaper()?1:0,o={seq:a,token:t,method:"add",isTestpaper:r,questionBankId:this.questionBankId};$.post(i,o).then((function(i){$("#cd-modal").modal("hide"),$(".js-create-btn").attr("disabled",!1);var r=a+1;s.orderQuestionList(r,$('[data-anchor="#'.concat(t,'"]')).parent(),$("#".concat(t))),$('[data-anchor="#'.concat(t,'"]')).parent().after(s.getNewListItem(a,e,n.text())),s.statErrorQuestions(),$("#".concat(t)).next(".subject-item").hasClass("subject-sub-item")?$('[data-material-token="'.concat(t,'"]')).last().after(i):$("#".concat(t)).after(i),tt.getEditor(e,$(".js-edit-form"),s.questionOperate)}))}},{key:"subItemAdd",value:function(t,e,i){var n=this,s=this.questionOperate.getQuestion(t).subQuestions.length+1,a=this.isTestpaper()?1:0,r={seq:s,token:t,method:"add",isSub:1,isTestpaper:a,questionBankId:this.questionBankId};$.post(i,r).then((function(i){$("#cd-modal").modal("hide"),$(".js-create-btn").attr("disabled",!1),$("#".concat(t)).next(".subject-item").hasClass("subject-sub-item")?$('[data-material-token="'.concat(t,'"]')).last().after(i):$("#".concat(t)).after(i),tt.getEditor(e,$(".js-edit-form"),n.questionOperate)}))}},{key:"getNewListItem",value:function(t,e,i){return"material"!==e?'<div class="col-sm-3 subject-list-item js-subject-list-item">\n          <div class="subject-list-item__num  js-subject-anchor" data-anchor="#'.concat(t,'">\n            <span class="js-list-index">').concat(t,'</span>\n            <label class="sb-checkbox cd-checkbox js-show-checkbox hidden" data-type="').concat(e,'"><input type="checkbox" data-toggle="cd-checkbox"></label>\n          </div>\n          <span class="js-type-name">').concat(i,"</span>\n        </div>"):'<div class="col-sm-3 subject-list-item js-subject-list-item">\n          <div class="subject-list-item__num  js-subject-anchor" data-anchor="#'.concat(t,'">\n            <span class="js-list-index">').concat(t,'</span>\n          </div>\n          <span class="js-type-name">').concat(i,"</span>\n        </div>")}},{key:"deleteSubjectItem",value:function(t){var e=this;this.isEditing()||(this.questionOperate.getTokenList().length<2?cd.message({type:"danger",message:Translator.trans("subject.question_delete_tip")}):cd.confirm({title:Translator.trans("subject.delete.title"),content:Translator.trans("subject.delete.content"),okText:Translator.trans("site.confirm"),cancelText:Translator.trans("site.cancel")}).on("ok",(function(){var i=$(t.currentTarget).parent().parent(),n=i.attr("id");if(i.hasClass("subject-sub-item")){n=i.attr("data-material-token");var s=i.attr("data-key");e.questionOperate.deleteSubQuestion(n,s),i.remove(),e.changeBottomFixed();var a=0;$('[data-material-token="'.concat(n,'"]')).each((function(){$(this).attr("id","sub".concat(a)),$(this).attr("data-key",a++),$(this).find(".subject-sub-item__number").text("(".concat(a,")"))}))}else{var r=e.questionOperate.getQuestion(n),o=e.questionOperate.getQuestionOrder(n),u=$("[data-anchor=#".concat(n,"]")).parent();e.orderQuestionList(o,u,i),e.questionOperate.deleteQuestion(n);var c=e;"material"===r.type&&i.nextUntil(".js-subject-main-item").each((function(){$(this).remove(),c.changeBottomFixed()})),u.remove(),i.remove(),c.changeBottomFixed(),e.statErrorQuestions()}})))}},{key:"changeBottomFixed",value:function(){var t=k()(window.scrollY+document.documentElement.clientHeight),e=0;if($(".es-footer-link").length?e=k()($(".es-footer-link").offset().top):$(".es-footer").length&&(e=k()($(".es-footer").offset().top)),e)e<t&&$(".js-subject-item-btn").removeClass("subject-bottom-fixed");else{var i=k()($(document).scrollTop()),n=k()($(document.body).height());i+k()($(window).height())>=n-560&&$(".js-subject-item-btn").removeClass("subject-bottom-fixed")}}},{key:"editTestpaperTitle",value:function(t){var e=$(t.target).val();if(""===$.trim(e))return cd.message({type:"danger",message:Translator.trans("subject.testpaper_title_empty_hint")}),void $(t.target).val(this.testpaperTitle);for(var i=e.length,n=0;n<e.length;n++)e.charCodeAt(n)>127&&i++;if(i>50)return cd.message({type:"danger",message:Translator.trans("subject.testpaper_title_too_long_hint")}),void $(t.target).val(this.testpaperTitle);this.testpaperTitle=e}},{key:"updateQuestionCountText",value:function(t){var e=this.questionOperate.getQuestionCount("total"),i=this.questionOperate.getQuestionCount(t);$(".js-total-num").text(Translator.trans("subject.question_count",{count:e})),$("[data-type=".concat(t,"]")).find(".subject-data__num").text(Translator.trans("subject.question_count",{count:i}))}},{key:"updateTotalScoreText",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.isTestpaper()&&t){var e=v()(this.questionOperate.getTotalScore()).toFixed(1);$(".js-total-score").text(Translator.trans("subject.total_score",{totalScore:e}))}}},{key:"orderQuestionList",value:function(t,e,i){var n=t,s=t;e.nextAll(".subject-list-item").each((function(){$(this).find(".js-list-index").text(n),n++})),i.nextAll(".subject-item").not(".subject-sub-item").each((function(){$(this).find(".subject-item__number").text(s),s++}))}},{key:"finishImport",value:function(t){if(!this.isEditing()){var e=!1,i=this,n="";if(this.$element.find(".subject-list-item__num--error").each((function(){n=n+$(this).find(".js-list-index").text()+"、",e=!0})),n=Translator.trans("subject.question_error_tip",{seqs:n.substring(0,n.length-1)}),e)cd.message({type:"danger",message:n});else if(this.isMaterialHasSub()){var s=this.isTestpaper()?this.testpaperTitle:"",a=$(t.currentTarget);a.button("loading"),$.ajax({type:"POST",url:a.data("url"),data:m()({title:s,questions:this.questionOperate.getQuestions()}),dataType:"json",contentType:"application/json;charset=utf-8",success:function(t){!0===t&&(a.button("reset"),cd.message({type:"success",message:Translator.trans("subject.save_success")}),i.redirect=!0,window.location.href=a.data("redirectUrl"))}})}}}},{key:"isMaterialHasSub",value:function(){for(var t=this,e=t.questionOperate.getTokenList(),i=0;i<e.length;i++){var n=e[i],s=t.questionOperate.getQuestion(n);if("material"===s.type&&0===s.subQuestions.length){var a=t.questionOperate.getQuestionOrder(n);return cd.message({type:"danger",message:Translator.trans("subject.material_nosub_tip",{seq:a})}),!1}}return!0}},{key:"statErrorQuestions",value:function(){var t="",e=!1;this.$element.find(".subject-list-item__num--error").each((function(){t=t+$(this).find(".js-list-index").text()+"、",e=!0})),t=Translator.trans("subject.question_error_tip",{seqs:t.substring(0,t.length-1)}),e?$(".js-error-tip").html(t):$(".js-error-tip").html("")}},{key:"addModalShow",value:function(t,e){if(!this.isEditing()){var i=$(t.currentTarget),n=$("#cd-modal"),s=i.closest(".js-subject-item").attr("id");e?(n.find('[data-type="material"]').addClass("hidden"),n.attr("data-sub","true")):(n.find('[data-type="material"]').removeClass("hidden"),n.attr("data-sub","false")),n.attr("data-index",s),n.modal("show")}}},{key:"isEditing",value:function(){var t=$(".js-subject-edit-item"),e=t.hasClass("js-sub-edit-item"),i="";if(0!==t.length){var n=t.find(".js-edit-form-seq").text();if(e){var s=t.find(".js-hidden-token").val(),a=$("#".concat(s)).find(".js-subject-item-number").text();i=$.trim(a)}var r=e?Translator.trans("subject.sub_is_editing_warning",{parentNum:i,seq:n}):Translator.trans("subject.is_editing_warning",{seq:n});return cd.message({type:"warning",message:r}),!0}return!1}},{key:"questionTypeConvert",value:function(t,e){var i=$(".js-subject-list").find("[data-anchor=#".concat(e,"]"));i.find(".js-show-checkbox").attr("data-type",t),i.next(".js-type-name").text(this.getTypeName(t))}},{key:"getTypeName",value:function(t){switch(t){case"single_choice":return Translator.trans("course.question.type.single_choice");case"uncertain_choice":return Translator.trans("course.question.type.uncertain_choice");case"choice":return Translator.trans("course.question.type.choice");case"determine":return Translator.trans("course.question.type.determine");case"essay":return Translator.trans("course.question.type.essay");case"fill":return Translator.trans("course.question.type.fill");case"material":return Translator.trans("course.question.type.material");default:return Translator.trans("course.question.type.unknown")}}},{key:"ieImg",value:function(){(x.a.ie10||x.a.ie11)&&this.$itemList.addClass("ie-item-list")}}],[{key:"_serializeArrayConvertToJson",value:function(t){var e,i={},n=it(t);try{for(n.s();!(e=n.n()).done;){var s=e.value;i[s.name]?(i[s.name].push||(i[s.name]=[i[s.name]]),i[s.name].push(s.value)):i[s.name]=s.value}}catch(t){n.e(t)}finally{n.f()}return i}}]),t}();new st},183:function(t,e,i){t.exports=i(425)},22:function(t,e){t.exports=jQuery},398:function(t,e,i){var n=i(78),s=i(1140),a=i(1143);function r(e,i,o){return"undefined"!=typeof Reflect&&s?t.exports=r=s:t.exports=r=function(t,e,i){var s=a(t,e);if(s){var r=n(s,e);return r.get?r.get.call(i):r.value}},r(e,i,o||e)}t.exports=r}});