(window.webpackJsonp=window.webpackJsonp||[]).push([["homeworkDo"],{"057e":function(t,e,n){"use strict";n("8e6e"),n("ac6a"),n("456d");var i=n("bd86"),r=n("2f62");function o(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}var s={name:"GuidePage",data:function(){return{isFristVisited:!1}},computed:function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?o(Object(n),!0).forEach((function(e){Object(i.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({},Object(r.e)({user:function(t){return t.user}})),created:function(){this.setVisited()},methods:{setVisited:function(){var t="".concat(this.user.id,"-task-visited");localStorage.getItem(t),localStorage.getItem(t)||(this.isFristVisited=!0,localStorage.setItem(t,!0))}}},a=n("0c7c"),c=Object(a.a)(s,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{directives:[{name:"show",rawName:"v-show",value:t.isFristVisited,expression:"isFristVisited"}],staticClass:"guide",on:{click:function(e){t.isFristVisited=!1}}},[n("div",{staticClass:"guide__text"},[t._v("左右切换滑动")]),t._m(0)])}),[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"guide__gesture"},[e("img",{attrs:{src:"static/images/leftslide.png"}}),e("img",{attrs:{src:"static/images/rightslide.png"}})])}],!1,null,null,null);e.a=c.exports},3841:function(t,e,n){"use strict";n.r(e),n("8e6e"),n("a481"),n("456d"),n("c5f6"),n("ac6a"),n("e7e5");var i=n("d399"),r=(n("e17f"),n("2241")),o=n("bd86"),s=n("3ce7"),a=n("faa5"),c=n("2f62"),u=n("057e"),l=n("f5cc"),h=n("ea9a"),f=n("8ae7"),d=n("c8a5"),m=n("7c97");function w(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function p(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?w(Object(n),!0).forEach((function(e){Object(o.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):w(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var g="",v={name:"HomeworkDo",components:{itemBank:l.a,guidePage:u.a,OutFocusMask:m.a},mixins:[h.a,f.a,d.a],data:function(){return{info:[],answer:{},lastAnswer:null,cardSeq:0,homework:null,cardShow:!1,localanswerName:null,localtimeName:null,lastUsedTime:null,usedTime:null,isHandHomework:!1,slideIndex:0,forceLeave:!1,interval:null}},computed:p({},Object(c.e)({isLoading:function(t){return t.isLoading},user:function(t){return t.user}})),mounted:function(){this.initReport(),this.getData(),this.saveAnswerInterval()},beforeRouteEnter:function(t,e,n){g="/"===e.fullPath?"/":"",n()},beforeRouteLeave:function(t,e,n){this.interval&&clearInterval(this.interval),0==this.info.length||this.isHandHomework||this.forceLeave||"doing"!=this.homework.status?n():this.submitpaper().then((function(){n()})).catch((function(){n(!1)}))},beforeDestroy:function(){this.clearTime(),r.a.close()},methods:p(p(p({},Object(c.d)({setNavbarTitle:a.v})),Object(c.c)("course",["handHomeworkdo","saveAnswerdo"])),{},{initReport:function(){this.initReportData(this.$route.query.courseId,this.$route.query.targetId,"homework")},getData:function(){var t=this,e=this.$route.query.homeworkId,n=this.$route.query.targetId;s.a.getHomeworkInfo({query:{homeworkId:e},data:{targetId:n,targetType:"task"}}).then((function(e){t.afterGetData(e)})).catch((function(e){var n=i.a.fail(e.message);"4036706"==e.code&&setTimeout((function(){t.toIntro(),n.clear()}),2e3)}))},afterGetData:function(t){this.setNavbarTitle(t.paperName),this.homework=t,this.isDoing()||(this.getLocalData(),this.formatData(t),this.interruption(),this.saveTime())},isDoing:function(){return"doing"!=this.homework.status&&(this.showResult(),!0)},interruption:function(){var t=this;this.$route.params.KeepDoing||this.canDoing(this.homework,this.user.id).then((function(){})).catch((function(e){var n=e.answer;t.submitHomework(n)}))},formatData:function(t){var e=this;t.items.forEach((function(t){if("material"!=t.type){var n=e.sixType(t.type,t,e.lastAnswer);e.$set(e.answer,t.id,n.answer),e.info.push(n.item)}if("material"==t.type){var i=Object.assign({},t,{subs:""});t.subs.forEach((function(n,r){n.parentTitle=i,n.parentType=t.type,n.materialIndex=r+1;var o=e.sixType(n.type,n,e.lastAnswer);e.$set(e.answer,n.id,o.answer),e.info.push(o.item)}))}}))},formatStatus:function(t,e){var n=0;return("single_choice"==t||"choice"==t||"uncertain_choice"==t||"determine"==t)&&this.answer[e].length>0||"essay"==t&&""!=this.answer[e][0]?n=1:"fill"==t?n=Number(this.answer[e].some((function(t){return""!=t}))):n},slideToNumber:function(t){var e=Number(t);this.cardSeq=e,this.cardShow=!1},getLocalData:function(){this.localanswerName="homework-".concat(this.user.id,"-").concat(this.homework.id),this.localuseTime="homework-".concat(this.user.id,"-").concat(this.homework.id,"-usedTime"),this.lastAnswer=JSON.parse(localStorage.getItem(this.localanswerName))},saveTime:function(){var t=this,e=localStorage.getItem(this.localuseTime)||0;this.usedTime=setInterval((function(){localStorage.setItem(t.localuseTime,++e)}),1e3)},clearTime:function(){clearInterval(this.usedTime),this.usedTime=null},submitpaper:function(){var t=this,e=0,n="题目已经做完，确认提交吗?",i=JSON.parse(JSON.stringify(this.answer));return Object.keys(i).forEach((function(t){i[t]=i[t].filter((function(t){return""!==t})),0===i[t].length&&e++})),e>0&&(n="还有".concat(e,"题未做，确认提交吗？")),new Promise((function(e,o){r.a.confirm({title:"提交",cancelButtonText:"立即提交",confirmButtonText:"检查一下",message:n}).then((function(e){t.cardShow=!0,o(e)})).catch((function(){t.clearTime(),t.submitHomework(i).then((function(t){e()})).catch((function(t){o(t)}))}))}))},submitHomework:function(t){var e=this;t||(t=JSON.parse(JSON.stringify(this.answer)),Object.keys(t).forEach((function(e){t[e]=t[e].filter((function(t){return""!==t}))})));var n={answer:t,homeworkId:this.$route.query.homeworkId,userId:this.user.id,homeworkResultId:this.homework.id};return new Promise((function(t,o){e.handHomeworkdo(n).then((function(n){e.isHandHomework=!0,t(),e.reprtData({eventName:"finish"}),e.showResult()})).catch((function(n){if("4036705"!=n.code)"50095204"!=n.code?o(n):r.a.confirm({title:"你已提交过答题，当前页面无法重复提交",showCancelButton:!1,confirmButtonText:"退出答题"}).then((function(){return e.exitPage()}));else{var s=i.a.fail(n.message);setTimeout((function(){e.isHandHomework=!0,s.clear(),t(),e.showResult()}),2e3)}}))}))},saveAnswerInterval:function(){var t=this;this.interval=setInterval((function(){t.saveAnswerAjax()}),3e4)},saveAnswerAjax:function(){var t=this;this.saveAnswerdo({admission_ticket:this.homework.admission_ticket,answer:JSON.parse(JSON.stringify(this.answer)),resultId:this.homework.id}).catch((function(e){var n=e.code,i=e.message,o=e.traceId;"50095204"!=n?"50095209"!=n?o?r.a.confirm({title:"答题保存失败，请保存截图后，联系技术支持处理",message:"【".concat(i,"】【").concat(o,"】"),confirmButtonText:"退出答题"}).then((function(){return t.exitPage()})):r.a.confirm({title:"网络连接不可用，自动保存失败",showCancelButton:!1,confirmButtonText:"重新保存"}).then((function(){return t.saveAnswerAjax()})):r.a.confirm({title:"有新答题页面，请在新页面中继续答题",showCancelButton:!1,confirmButtonText:"确定"}).then((function(){return t.exitPage()})):r.a.confirm({title:"你已提交过答题，当前页面无法重复提交",showCancelButton:!1,confirmButtonText:"退出答题"}).then((function(){return t.exitPage()}))}))},exitPage:function(){this.forceLeave=!0,this.$router.push("/course/".concat(this.homework.courseId))},showResult:function(){this.$router.replace({name:"homeworkResult",query:{homeworkId:this.$route.query.homeworkId,homeworkResultId:this.homework.id,taskId:this.$route.query.targetId,backUrl:g,courseId:this.$route.query.courseId}})},toIntro:function(){this.$router.replace({name:"homeworkIntro",query:{courseId:this.$route.query.courseId,taskId:this.$route.query.targetId,backUrl:g}})}})},b=n("0c7c"),k=Object(b.a)(v,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"paper-swiper"},[n("out-focus-mask",{attrs:{type:t.outFocusMaskType,isShow:t.isShowOutFocusMask,reportType:t.reportType},on:{outFocusMask:t.outFocusMask}}),t.isLoading?n("e-loading"):t._e(),t.info.length>0?n("item-bank",{attrs:{current:t.cardSeq,info:t.info,answer:t.answer,"show-score":!1,"slide-index":t.slideIndex,all:t.info.length},on:{"update:current":function(e){t.cardSeq=e},"update:answer":function(e){t.answer=e},"update:slideIndex":function(e){t.slideIndex=e},"update:slide-index":function(e){t.slideIndex=e}}}):t._e(),n("guide-page"),n("div",{staticClass:"paper-footer"},[n("div",[n("span",{on:{click:function(e){t.cardShow=!0}}},[n("i",{staticClass:"mb-8 iconfont icon-Questioncard"}),t._v("\n        "+t._s(t.$t("courseLearning.questionCard"))+"\n      ")])]),n("div",[n("span",{on:{click:t.submitpaper}},[n("i",{staticClass:"mb-8 iconfont icon-submit"}),t._v("\n        "+t._s(t.$t("courseLearning.handInThePaper"))+"\n      ")])])]),n("van-popup",{attrs:{position:"bottom"},model:{value:t.cardShow,callback:function(e){t.cardShow=e},expression:"cardShow"}},[t.info.length>0?n("div",{staticClass:"card"},[n("div",{staticClass:"card-title"},[n("div",[n("span",{staticClass:"card-finish"},[t._v(t._s(t.$t("courseLearning.completed")))]),n("span",{staticClass:"card-nofinish"},[t._v(t._s(t.$t("courseLearning.notCompleted")))])]),n("i",{staticClass:"iconfont icon-no",on:{click:function(e){t.cardShow=!1}}})]),n("div",{staticClass:"card-list"},[n("div",{staticClass:"card-homework-item"},[n("div",{staticClass:"card-item-list"},t._l(t.info,(function(e){return n("div",{key:e.id,class:["list-cicle",1==t.formatStatus(e.type,e.id)?"cicle-active":""],on:{click:function(n){return t.slideToNumber(e.seq)}}},[t._v("\n              "+t._s(e.seq)+"\n            ")])})),0)])])]):t._e()])],1)}),[],!1,null,null,null);e.default=k.exports},ea9a:function(t,e,n){"use strict";n("e17f");var i=n("2241");n("456d"),n("ac6a"),e.a={methods:{canDoing:function(t,e){return new Promise((function(n,r){if(t&&"doing"===t.status){var o="homework-".concat(e,"-").concat(t.id),s=JSON.parse(localStorage.getItem(o));s=s?Object.keys(s).forEach((function(t){s[t]=s[t].filter((function(t){return""!==t}))})):{},i.a.confirm({title:"提示",cancelButtonText:"放弃做题",confirmButtonText:"继续做题",message:"您有未完成的作业，是否继续？"}).then((function(){n()})).catch((function(){r({answer:s})}))}}))}}}}}]);