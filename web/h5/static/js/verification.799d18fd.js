(window.webpackJsonp=window.webpackJsonp||[]).push([["verification"],{7067:function(e,t,i){"use strict";i("e17f");var a=i("2241"),r=(i("e7e5"),i("d399")),o=i("a026"),n=i("3ce7"),s=/micromessenger/.test(navigator.userAgent.toLowerCase());t.a=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!e||i&&!t)r.a.fail("缺少分享参数");else{var c={domainUri:location.origin,itemUri:"",source:"h5"};n.a.marketingActivities({query:{activityId:e},data:c}).then((function(e){var n=-1!==e.url.indexOf("?")?"&":"?",c=i?"".concat(t).concat(n,"ticket=").concat(e.ticket):e.url;s?window.location.href=c:a.a.confirm({message:"去微信完成活动",confirmButtonText:"复制链接",title:""}).then((function(){try{o.default.prototype.$copyText(c).then((function(){r.a.success("复制成功")}),(function(){r.a.fail("请更换浏览器复制")}))}catch(e){r.a.fail("请更换浏览器复制")}})).catch((function(){}))})).catch((function(e){r.a.fail(e.message)}))}}},9477:function(e,t,i){"use strict";i.r(t),i("7f7f"),i("4917"),i("e7e5");var a=i("d399"),r=i("a262"),o=i("d863"),n=i("bc3a"),s=i.n(n),c=i("3ce7"),u=i("faa5"),d={mixins:[r.a,o.a],data:function(){return{regular:!1,tipShow:!0,failTextShow:!1,imgAddress:"",btnText:"立即开启摄像头",uploadParams:{},requestStartT:"",requestEndT:"",verifiedText:"认证",errorShow:!1,scanCode:this.$route.query.loginToken||""}},mounted:function(){var e=this;1==this.$route.query.faceRegistered&&(this.verifiedText="设置");var t={type:this.$route.query.type,loginField:this.$route.query.loginField,loginToken:this.scanCode};c.a.getSessions({data:t}).then((function(t){e.regular=!0;var i=t.upload.form;e.uploadParams={sessionId:t.id,uploadUrl:i.action,uploadKey:i.params.key,uploadToken:i.params.token}})).catch((function(t){e.errorShow=!0,setTimeout(e.feedbackAction,3e3)}))},methods:{polling:function(){var e=this,t=this;c.a.faceSession({query:{sessionId:this.uploadParams.sessionId},params:{loginToken:this.scanCode}}).then((function(i){if("processing"===i.status){if(e.requestStartT?e.requestEndT=new Date:e.requestStartT=new Date,(e.requestEndT?e.requestEndT-e.requestStartT:0)>58e3)return void t.recognitionFail();setTimeout((function(){t.polling()}),2e3)}else if("successed"===i.status){if(a.a.success({duration:2e3,message:"人脸识别成功"}),e.scanCode)return void setTimeout(e.feedbackAction,3e3);if(i.login){var r={avatar:{large:i.login.largeAvatar,medium:i.login.mediumAvatar,small:i.login.smallAvatar}},o=Object.assign(i.login.user,r);e.$store.commit(u.F,{token:i.login.token,user:o})}e.afterLogin()}else if(1===i.lastFailed){if(a.a.fail({duration:2e3,message:"人脸识别".concat(e.verifiedText,"失败，多次不通过")}),e.scanCode)return void setTimeout(e.feedbackAction,3e3);e.failTextShow=!0,e.tipShow=!1,setTimeout((function(){e.$router.push({name:"login",query:{redirect:e.$route.query.redirect||""}})}),3e3)}else e.recognitionFail()})).catch((function(t){5==t.code&&(e.errorShow=!0,setTimeout(e.feedbackAction,3e3))}))},isWeixin:function(){return"micromessenger"==navigator.userAgent.toLowerCase().match(/MicroMessenger/i)},feedbackAction:function(){this.isWeixin()?WeixinJSBridge.call("closeWindow"):this.$router.back(-1)},recognitionFail:function(){a.a.fail({duration:2e3,message:"人脸识别".concat(this.verifiedText,"失败")}),this.scanCode?setTimeout(this.feedbackAction,3e3):(this.tipShow=!0,this.btnText="重新".concat(this.verifiedText))},openCamera:function(e){var t=this,i=e.target.files[0],a=new FileReader;a.readAsDataURL(i),a.onloadend=function(e){t.imgAddress=e.target.result,t.tipShow=!1};var r=this.uploadParams.uploadUrl,o=new FormData;o.append("file",i,i.name),o.append("token",this.uploadParams.uploadToken),o.append("key",this.uploadParams.uploadKey),s.a.post(r,o,{headers:{"Content-Type":"multipart/form-data"},interceptor:"end"}).then((function(e){var i={query:{sessionId:t.uploadParams.sessionId},params:{loginToken:t.scanCode},data:{response_body:JSON.stringify(e.data),response_code:e.status}};c.a.finishUploadResult(i).then((function(e){e.success&&(t.tipShow=!1,t.polling())})).catch((function(e){5==e.code&&(t.errorShow=!0,setTimeout(t.feedbackAction,3e3))}))})).catch((function(e){}))}}},l=i("0c7c"),f=Object(l.a)(d,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"login-face-verification"},[e.errorShow?e._e():i("div",{directives:[{name:"show",rawName:"v-show",value:e.regular,expression:"regular"}]},[i("div",{directives:[{name:"show",rawName:"v-show",value:e.tipShow,expression:"tipShow"}],staticClass:"verification-tips"},[i("div",[e._v("即将进行人脸识别"+e._s(e.verifiedText))]),i("div",{staticClass:"mt5"},[e._v("请将面部正对摄像头")])]),e.failTextShow?e._e():i("div",{directives:[{name:"show",rawName:"v-show",value:!e.tipShow,expression:"!tipShow"}]},[i("img",{staticClass:"img-content",attrs:{src:e.imgAddress,alt:"人脸照片"}}),i("div",[e._v(e._s(e.verifiedText)+"中，请稍候...")])]),i("div",{directives:[{name:"show",rawName:"v-show",value:e.failTextShow,expression:"failTextShow"}]},[e._v("\n      人脸识别多次"+e._s(e.verifiedText)+"不通过\n      "),i("div",{staticClass:"mt5"},[e._v("请改用其它方式"+e._s(e.verifiedText)+"或联系管理员")])]),i("div",{directives:[{name:"show",rawName:"v-show",value:e.tipShow,expression:"tipShow"}]},[i("label",{staticClass:"btn-open-camera",attrs:{for:"cameraItem"}},[e._v(e._s(e.btnText))]),i("input",{staticClass:"hide",attrs:{id:"cameraItem",type:"file",accept:"image/*",capture:"user"},on:{change:e.openCamera}})])]),e.errorShow?i("div",[e._v("\n    此链接已失效\n    "),i("div",{staticClass:"mt5"},[e._v("请确认后再操作")])]):e._e()])}),[],!1,null,null,null);t.default=f.exports},a262:function(e,t,i){"use strict";var a=i("7067");t.a={methods:{activityHandle:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];Object(a.a)(e,t,i)}}}},d863:function(e,t,i){"use strict";i("8e6e"),i("ac6a"),i("456d"),i("a481");var a=i("bd86"),r=i("7067"),o=i("3ce7"),n=i("faa5"),s=i("2f62");function c(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,a)}return i}function u(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?c(Object(i),!0).forEach((function(t){Object(a.a)(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):c(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}t.a={data:function(){return{redirect:""}},computed:u({},Object(s.e)({user:function(e){return e.user}})),created:function(){this.redirect=decodeURIComponent(this.$route.fullPath)},methods:u(u({},Object(s.d)([n.u])),{},{afterLogin:function(){var e=this;this.checkMobileBind().then((function(t){var i=t.is_bind_mobile,a=t.mobile_bind_mode;e[n.u]({is_bind_mobile:i,mobile_bind_mode:a}),i||"closed"===a?setTimeout(e.jumpAction,1e3):e.$router.replace({name:"binding",query:{redirect:e.$route.query.redirect}})})).catch((function(){setTimeout(e.jumpAction,1e3)}))},jumpAction:function(){var e=this.$route.query.redirect?decodeURIComponent(this.$route.query.redirect):"/",t=this.$route.query.skipUrl?decodeURIComponent(this.$route.query.skipUrl):"",i=this.$route.query.callbackType,a=this.$route.query.activityId,o=decodeURIComponent(this.$route.query.callback);if(i)switch(i){case"marketing":Object(r.a)(a,o)}else t?this.$router.replace({path:e,query:{backUrl:t}}):this.$router.replace({path:e})},checkMobileBind:function(){return o.a.mobileBindCheck({query:{userId:this.user.id}})}})}}}]);